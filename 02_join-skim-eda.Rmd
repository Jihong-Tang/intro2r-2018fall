---
title: "join, skim, EDA"
output: html_notebook
---

# Load Packages

```{r}
library(tidyverse)
library(skimr)
library(ggvis)
```

# Load Data

- Star Wars character data are an onboard part of dplyr:  `dplyr::starwars`

- Star Wars survey data are from fivethirtyeight.com.  

    - https://github.com/fivethirtyeight/data/tree/master/star-wars-survey
    - https://data.fivethirtyeight.com/
    - Unless otherwise noted, five thirty eight data sets are available under the Creative Commons Attribution 4.0 International License, and the code is available under the MIT License.
    - https://fivethirtyeight.com/features/americas-favorite-star-wars-movies-and-least-favorite-characters/

Load the survey data that deals with character's favorability rating.  

```{r load_data}
sw_characters_favorability <- read_csv(
  "https://raw.githubusercontent.com/fivethirtyeight/data/master/star-wars-survey/StarWars.csv", 
  skip = 1)[,16:29]   # Skip first line due to funky column headers.  
                      # [,16:29] ingests columns 16 through 29.
```

# Skim Data

## Star Wars Charactesr

```{r show_dplyr-starwars-tibble}
starwars
```

## Favorability Data

```{r class_glimpse}
class(sw_characters_favorability)

glimpse(sw_characters_favorability)
```

```{r show_sw-chars-tibble}
sw_characters_favorability
```

# Transform Favorability Data

Get a list of the characters which happen to be the column names

```{r get-colnames}
sw_characters_colnames <- colnames(sw_characters_favorability)
sw_characters_colnames
```

```{r transform-fav-data}

favorability_popularity_rating <- sw_characters_favorability %>% 
  map_dfr(fct_count) %>% 
  filter(f == "Very favorably") %>% 
  add_column(name = sw_characters_colnames) %>% 
  select(name, fav_rating = n)

favorability_popularity_rating
```


## Join Data


```{r join-data}
sw_joined <- starwars %>% 
  inner_join(favorability_popularity_rating, by = "name") %>% 
  select(1, 14, 2:14) 

sw_joined %>% 
  arrange(desc(fav_rating))
```



#  EDA

## Skim

```{r skim-joined}
skim(sw_joined)
```


```{r}
skim(starwars)
```


# Visualize

## Scatter Plot

```{r scatterplot-fav_rating}
sw_joined %>% 
  ggvis(~height, ~fav_rating) %>% 
  layer_points()
```

## Box Plot

```{r}
starwars %>% 
  drop_na(species, mass) %>% 
  filter(species == "Human" |
           species == "Droid" |
           species == "Mirialan") %>% 
  ggvis(~species, ~mass) %>% 
  layer_boxplots()
```

## Histogram

```{r}
starwars %>% 
  ggvis(~birth_year) %>% 
  layer_histograms()
```


```{r}
starwars %>% 
  ggvis(~height) %>% 
  layer_histograms()
```


```{r}
starwars %>%   
  ggvis(~eye_color) %>% 
  layer_bars()
```


```{r}
fct_count(starwars$eye_color, sort = TRUE) %>% 
  head() %>% 
  ggvis(~f, ~n) %>% 
  layer_bars() %>% 
  add_axis("x", title = "Eye Color") %>% 
  add_axis("y", title = "Frequency") %>% 
  scale_ordinal('x', domain=c("brown", "blue", "yellow", "black", "orange", "red")) 
```


# Session Info

```{r}
devtools::session_info()
```

